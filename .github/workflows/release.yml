name: Auto Release on Tag

# This workflow automatically creates releases when tags are pushed
# For manual releases, use the "Create Release" workflow instead

on:
  push:
    tags:
      - 'v*'

jobs:
  auto-release:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Get tag name
      id: get_tag
      run: |
        TAG=${GITHUB_REF#refs/tags/}
        echo "tag=$TAG" >> $GITHUB_OUTPUT
        echo "Creating automatic release for tag: $TAG"

    - name: Trigger release creation
      run: |
        echo "Triggering Create Release workflow for tag ${{ steps.get_tag.outputs.tag }}"
        
        # Trigger the create-release workflow with popular build settings
        gh workflow run create-release.yml \
          --field release_type="popular" \
          --field tag_name="${{ steps.get_tag.outputs.tag }}" \
          --field prerelease=false \
          --field draft=false
        
        echo "Release workflow triggered. Check the Actions tab for progress."
        echo "The release will be created automatically once the build completes."
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Auto-release summary
      run: |
        echo "## ðŸ·ï¸ Automatic Release Triggered" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Tag**: ${{ steps.get_tag.outputs.tag }}" >> $GITHUB_STEP_SUMMARY
        echo "**Type**: Popular tools and architectures" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "The Create Release workflow has been triggered and will:" >> $GITHUB_STEP_SUMMARY
        echo "1. Build tools for popular architectures" >> $GITHUB_STEP_SUMMARY
        echo "2. Create release with binaries" >> $GITHUB_STEP_SUMMARY
        echo "3. Generate checksums and documentation" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**ðŸ“Š Check progress**: [Actions Tab](https://github.com/${{ github.repository }}/actions)" >> $GITHUB_STEP_SUMMARY